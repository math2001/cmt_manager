<!doctype html>
<html lang="en">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <title>CMT Manager</title>
</head>
<body>
  <div class="navbar navbar-expand-lg navbar-light bg-light sticky-top">
    <a class="navbar-brand" href="/">CMT Manager</a>
    <div class="form-inline ml-auto">
      <input
        type="submit"
        value="Submit"
        form="control-form"
        class="btn btn-outline-success">
    </div>
  </div>

  <div class="container my-4">
    <div class="row">
      <div class="col-2">
        <h4>Group</h4>
        <div class="nav flex-column nav-pills" id="v-groups-tab" role="tablist" aria-orientation="vertical">
          {% for group in groups %}
          <a
            class="nav-link"
            id="v-groups-{{ group }}-tab"
            data-toggle="pill"
            href="#v-groups-{{ group }}"
            role="tab"
            aria-controls="v-groups-{{ group }}">
            {{ group }}
          </a>
          {% endfor %}
      </div>
      </div>
      <div class="col-2">
        <h4>Node</h4>
        <div class="tab-content" id="v-nodes-tab">
          {% for group, nodes in groups.items %}
          <div class="tab-pane" id="v-groups-{{ group }}" role="tabpanel" aria-labelledby="v-groups-{{ group }}-tab">
            <div class="nav flex-column nav-pills" id="v-groups-nodes-tab" role="tablist" aria-orientation="vertical">
              {% for node in nodes %}
              <a
                class="nav-link"
                id="v-nodes-{{ group }}-{{ node }}-tab"
                data-toggle="pill"
                href="#v-nodes-{{ group }}-{{ node }}"
                role="tab"
                aria-controls="v-nodes-{{ group }}-{{ node }}">
                {{ node }}
              </a>
              {% endfor %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      <div class="col-6">
        <h4>Probe Controls</h4>
        <form action="{% url 'enabler:update-probes-conf' %}" method="POST" id="control-form">
          {% csrf_token %}
          <div class="tab-content" id="v-nodes-tabContent">
            {% for group, nodes in groups.items %}
            {% for node, state in nodes.items %}
            <div class="tab-pane" id="v-nodes-{{ group }}-{{ node }}">
              <div class="btn-group btn-group-toggle my-1 mr-1" data-toggle="buttons">
                <label class="btn btn-info">
                  <input
                    type="radio"
                    name="{{ group }}-{{ node }}-enabled"
                    {% if state.enabled %} checked {% endif %}
                    value="true"
                    autocomplete="off">
                  Enable
                </label>
                <label class="btn btn-info">
                  <input
                    type="radio"
                    name="{{ group }}-{{ node }}-enabled"
                    value="false"
                    {% if not state.enabled %} checked {% endif %}
                    autocomplete="off">
                  Disable
                </label>
              </div>

              <div class="btn-group btn-group-toggle my-1" data-toggle="buttons">
                {% for level in levels %}
                <label class="btn btn-secondary">
                  <input
                    type="radio"
                    name="{{ group }}-{{ node }}-level"
                    value="{{ level }}"
                    {% if level == state.level %} checked {% endif %}
                    autocomplete="off">
                    {{ level | title }}
                </label>
                {% endfor %}
              </div>

              <div class="container my-4 px-0">
                <h5>Checks</h5>
                {% for check, enabled in state.checks.items %}
                <h6><code>{{ check }}</code></h6>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <label
                      class="input-group-text"
                      for="{{ group }}-{{ node }}-{{ check }}-disabled-time-range">
                    Disabled time range
                  </label>
                </div>
                <input
                  name="{{ group }}-{{ node }}-{{ check }}-disabled-time-range"
                  type="text"
                  class="form-control"
                  id="{{ group }}-{{ node }}-{{ check }}-disabled-time-range"
                  placeholder="Enter time range">
                </div>
                <small class="form-text text-muted">
                  Enter a valid time range. Leave empty to enable.
                </small>
                {% endfor %}
              </div>
            </div>
            {% endfor %}
            {% endfor %}
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

  <script>
      // when user clicks on group element
      $('#v-groups-tab').on('hide.bs.tab', e => {
        // in the "Node" tab section, deselect the highlighted node
        // so that we re-click on the group we are hiding right now
        // nothing is selected
        $("#v-nodes-tab .tab-pane.active .nav-link.active").removeClass("active")
        // hide the "Probe Controls" tab section
        $("#v-nodes-tabContent .tab-pane.active").removeClass("active")
      })
    </script>
  </body>
</html>